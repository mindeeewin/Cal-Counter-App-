<!DOCTYPE html>
<html>
 <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>Weekly Calorie Journal</title>
    
    <!-- Custom Styles-->
    <link rel="stylesheet" href="foodjournalstyle.css">
</head>
<body onload="setCalorieStorage()">
 <!--Background Fixed Image-->
    <div class="background"></div>

     <!-- Submit Data for Food-->
     <h1><center>Weekly Calorie Journal </center></h1>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
            <form>
                <div class="banner-info" align="center">
                    <label><b>DATE: </b></label>
                    <input type="date" class="text-center" placeholder="MM/DD/YYYY" id="custDate"></type>
                    <label><b>FOOD ITEM (100g): </b></label>
                    <input type="text" class="text-center" placeholder="Food Type" id="custName"></type>
                </div>
            </form>

    <!-- "Add" Data Button-->
    <div class="logo">
        <h2><button><input type="button" class="btn btn-outline-success" onClick="insertData()" value="Add"></button></h2>
    </div>
    <!--Calorie Counting Table Starts-->
   <!-- <table id="t1">
        <colgroup>
            <col span="2" class="c2">
                <col>
                    <col class="row:after">
        </colgroup>
        <thead>
            <tr>
                <th><u>
                    Date
                </u></th>
                <th><u>
                    Meal
                </u></th>
                <th><u>
                    Calories
                </u></th>
            </tr>
        </thead>
        <tbody id="TableBody">
        </tbody>
    </table>-->


<table id="calorieTable" class="table table-hover" class="table-responsive">
    <thead>
        <tr>
        <th scope="col"><u>DATE</u></th>
        <th scope="col"><u>MEAL</u></th>
        <th scope="col"><u>CALORIES</u></th>
        </tr>
    </thead>
    <tbody id="displayFoodList">
        <tr id="totalRow">
            <td></td>
            <td>Total</td>
            <td id="totalCal"></td>
          </tr>
    </tbody>

</table>



<!--Pulling API data for Food Calories Start-->
<script language="javascript">

    const setCalorieStorage = () => {
        let foodCaloriesHolder = []
        localStorage.setItem('foodCalories', JSON.stringify(foodCaloriesHolder))
    }
    //Save Food Cal on Local Storage 
    const insertData = async () => {
        const calorieResponse = await getCaloriesForFoodItem();
        let calories = calorieResponse[0].calories
        foodCaloriesHolder = JSON.parse(localStorage.getItem('foodCalories'));
        foodCaloriesHolder.push(calories)
        localStorage.setItem('foodCalories', JSON.stringify(foodCaloriesHolder))
        insertRow(calorieResponse[0].calories)
        
    }
    //Add Additional Row with Food Type Input
    const insertRow = (calories) => {
        let table = document.getElementById("displayFoodList");
        let row = table.insertRow(0);
        let cell1 = row.insertCell(0);
        let cell2 = row.insertCell(1);
        let cell3 = row.insertCell(2);
        cell1.innerHTML = document.getElementById('custDate').value;
        cell2.innerHTML = document.getElementById('custName').value;
        cell3.innerHTML = calories;

        let getTotalCalories = computeTotalCalories();
        let totalCell = document.getElementById("totalCal");
        totalCell.innerHTML = getTotalCalories;
        document.getElementById('custDate').value = ``;
        document.getElementById('custName').value = ``;
    }
    //Recieve Data form API 
    const getCaloriesForFoodItem = async () => {
        const a = document.getElementById('custName').value;
        console.log('a', a)
        const response = await fetch (`https://api.api-ninjas.com/v1/nutrition?query=${a}`, {
            method: "GET",
            headers:  { 'X-Api-Key': 'T3RdfpebuPAxVxdbA5AuUvcQgBbKHPLJiidRx0ba'},
            contentType: 'application/json',
        });

        return await response.json();
    }

    const computeTotalCalories = () => {
        let computeCalories = JSON.parse(localStorage.getItem('foodCalories'));
        let totalCalories = computeCalories.reduce((a, b) => a + b, 0); //Total Sumation of Cal 
        return totalCalories;
    }

   
</script>
</body>

</html>
